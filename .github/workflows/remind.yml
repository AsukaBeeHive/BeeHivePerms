name: Reminder

on:
  schedule:
    - cron: '0 12 * * 4'

  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Check last commit date
        run: |
          export TZ='Asia/Tokyo'
          if [ ! -f "perms_list.json" ]; then
            echo "❌ perms_list.jsonファイルが見つかりません"
            exit 1
          fi
          LAST_COMMIT_TIMESTAMP=$(git log -1 --format="%ct" -- perms_list.json)
          if [ -z "$LAST_COMMIT_TIMESTAMP" ]; then
            echo "❌ perms_list.jsonのコミット履歴が見つかりません"
            exit 1
          fi
          CURRENT_TIMESTAMP=$(date +%s)
          ONE_WEEK_SECONDS=$((7 * 24 * 60 * 60))
          ELAPSED_SECONDS=$((CURRENT_TIMESTAMP - LAST_COMMIT_TIMESTAMP))
          
          ELAPSED_DAYS=$((ELAPSED_SECONDS / 86400))
          ELAPSED_HOURS=$(((ELAPSED_SECONDS % 86400) / 3600))
          ELAPSED_MINUTES=$(((ELAPSED_SECONDS % 3600) / 60))
          
          echo "perms_list.json最終更新日時: $(TZ='Asia/Tokyo' date -d @$LAST_COMMIT_TIMESTAMP '+%Y年%m月%d日 %H時%M分 (JST)')"
          echo "現在時刻: $(TZ='Asia/Tokyo' date -d @$CURRENT_TIMESTAMP '+%Y年%m月%d日 %H時%M分 (JST)')"
          echo "経過時間: ${ELAPSED_DAYS}日${ELAPSED_HOURS}時間${ELAPSED_MINUTES}分経過"
          
          if [ $ELAPSED_SECONDS -gt $ONE_WEEK_SECONDS ]; then
            echo "⚠️ 未コミットです"
            echo "perms_list.jsonが1週間以上更新されていません。"
            
            # GitHubの通知機能を使用する場合（オプション）
            echo "::warning::perms_list.jsonが1週間以上更新されていません"
          else
            echo "✅ 最近更新されています"
            echo "perms_list.jsonは最後の更新から${ELAPSED_DAYS}日${ELAPSED_HOURS}時間${ELAPSED_MINUTES}分経過"
          fi
